{{- if .Values.winterSoilder.enable  }}

apiVersion: pincher.devtron.ai/v1alpha1
kind: Hibernator

metadata:
  name: {{ template ".Chart.Name .fullname" $ }}-hibernator
  labels:
    app: {{ template ".Chart.Name .name" $ }}
    appId: {{ $.Values.app | quote }}
    envId: {{ $.Values.env | quote }}
    chart: {{ template ".Chart.Name .chart" $ }}
    release: {{ $.Release.Name }}
{{- if $.Values.appLabels }}
{{ toYaml $.Values.appLabels | indent 4 }}
{{- end }}
    {{- if $.Values.winterSoilder.labels }}
{{ toYaml $.Values.winterSoilder.labels | indent 4 }}
    {{- end }}
{{- if $.Values.winterSoilder.annotations }}
  annotations:
{{ toYaml $.Values.winterSoilder.annotations | indent 4 }}
{{- end }}

spec:
  timeRangesWithZone:
    timeZone: {{ $.Values.winterSoilder.timeZone | quote }}
    {{- if $.Values.winterSoilder.timeRanges }}
    timeRanges:
{{ toYaml $.Values.winterSoilder.timeRanges | indent 6 }}
    {{- end -}}
  selectors:
    - inclusions:
        - objectSelector:
            name: {{ include ".Chart.Name .fullname" $ }}
            type: "rollout"
            fieldSelector:
              - AfterTime(AddTime(ParseTime({{metadata.creationTimestamp}}, '2006-01-02T15:04:05Z'), {{$.Values.winterSolider.fieldSelector | squote }}), Now())
          namespaceSelector:
            name: {{ $.Release.Namespace }}
      exclusions: []
  action: {{$.Values.winterSoilder.action}}
{{- end}}