{{- if $.Values.kedaHttpScaledObject.enabled }}
apiVersion: http.keda.sh/v1alpha1
kind: HTTPScaledObject
metadata:
  name: {{ template ".Chart.Name .fullname" $ }}-kedaHttpScaled
  labels:
    app: {{ template ".Chart.Name .name" . }}
    appId: {{ $.Values.app | quote }}
    envId: {{ $.Values.env | quote }}
    chart: {{ template ".Chart.Name .chart" . }}
    release: {{ .Release.Name }}
  {{- if .Values.appLabels }}
  {{ toYaml .Values.appLabels | indent 4 }}
  {{- end }}
  {{- if .Values.kedaAutoscaling.labels }}
  {{ toYaml .Values.kedaAutoscaling.labels | indent 4 }}
  {{- end }}
  {{- if .Values.kedaAutoscaling.annotations }}
  annotations:
  {{ toYaml .Values.kedaAutoscaling.annotations | indent 4 }}
  {{- end }}
spec:
  scaleTargetRef:
    deployment: {{ include ".Chart.Name .fullname" $ }}
    service: {{ template ".servicename" . }}
    port: {{ $.Values.kedaHttpScaledObject.servicePort }}
  host: {{ template ".servicename" . }}
  replicas:
    min: {{ .Values.kedaHttpScaledObject.minReplicaCount }}
    max: {{ .Values.kedaHttpScaledObject.maxReplicaCount }}
  {{- if .Values.kedaHttpScaledObject.targetPendingRequests  }}
  targetPendingRequests: {{ .Values.kedaHttpScaledObject.targetPendingRequests }}
  {{- end }}
  {{- if .Values.kedaHttpScaledObject.scaledownPeriod }}
  scaledownPeriod: {{ .Values.kedaHttpScaledObject.scaledownPeriod }}
  {{- end }}
{{- end }}