openapi: "3.0.0"
info:
  version: 1.0.0
  title: Rollback API
paths:
  /orchestrator/app/history/deployed-configuration/all/{appId}/{pipelineId}/{wfrId}:
    get:
      operationId: FetchHistoryDetail
      description: Fetch history configuration for a particular trigger (by wfrId)
      parameters:
        - name: appId
          in: path
          required: true
          schema:
            type: integer
            description: ID of the application
        - name: pipelineId
          in: path
          required: true
          schema:
            type: integer
            description: ID of the pipeline
        - name: wfrId
          in: path
          required: true
          schema:
            type: integer
            description: ID of the workflow runner
      responses:
        '200':
          description: Successfully return history detail
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HistoryConfigurationDetailDto'
        '400':
          description: Bad Request. Input Validation error/wrong request body.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Unauthorized User
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /orchestrator/app/history/deployed-configuration/all/latest/{appId}/{pipelineId}:
    get:
      operationId: FetchLatestHistoryDetail
      description: Fetch latest deployed history configuration
      parameters:
        - name: appId
          in: path
          required: true
          schema:
            type: integer
            description: ID of the application
        - name: pipelineId
          in: path
          required: true
          schema:
            type: integer
            description: ID of the pipeline
      responses:
        '200':
          description: Successfully return history detail
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HistoryConfigurationDetailDto'
        '400':
          description: Bad Request. Input Validation error/wrong request body.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Unauthorized User
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /orchestrator/app/deployment-configuration/all/latest/{appId}/{pipelineId}:
    get:
      operationId: FetchDeploymentConfiguration
      description: Fetch latest deployment configuration i.e. currently saved in the system and marked as active
      parameters:
        - name: appId
          in: path
          required: true
          schema:
            type: integer
            description: ID of the application
        - name: pipelineId
          in: path
          required: true
          schema:
            type: integer
            description: ID of the pipeline
      responses:
        '200':
          description: Successfully return configuration detail
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HistoryConfigurationDetailDto'
        '400':
          description: Bad Request. Input Validation error/wrong request body.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Unauthorized User
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

components:
  schemas:
    HistoryConfigurationDetailDto:
      type: object
      properties:
        deploymentTemplate:
          type: object
          properties:
            config:
              type: object
              properties:
                codeEditorValue:
                  type: object
                  properties:
                    value:
                      type: string
                      description: Template value
                    displayName:
                      type: string
                      description: Display name of the template
                isAppMetrics:
                  type: boolean
                  description: Whether app metrics are enabled
                templateName:
                  type: string
                  description: Name of the template
                templateVersion:
                  type: string
                  description: Version of the template
        configMap:
          type: object
          properties:
            childList:
              type: array
              items:
                type: object
                properties:
                  componentName:
                    type: string
                    description: Name of the component
                  config:
                    type: object
                    properties:
                      codeEditorValue:
                        type: object
                        properties:
                          value:
                            type: string
                            description: Config value
                          displayName:
                            type: string
                            description: Display name of the config
                      type:
                        type: string
                        description: Type of the config
                      external:
                        type: boolean
                        description: Whether the config is external
                      mountPath:
                        type: string
                        description: Mount path for the config
                      externalType:
                        type: string
                        description: Type of external config
                      roleARN:
                        type: string
                        description: ARN of the role
                      subPath:
                        type: string
                        description: Sub path for the config
                      filePermission:
                        type: string
                        description: File permissions
        secret:
          type: object
          properties:
            childList:
              type: array
              items:
                type: object
                properties:
                  componentName:
                    type: string
                    description: Name of the component
                  config:
                    type: object
                    properties:
                      codeEditorValue:
                        type: object
                        properties:
                          value:
                            type: string
                            description: Secret value
                          displayName:
                            type: string
                            description: Display name of the secret
                      type:
                        type: string
                        description: Type of the secret
                      external:
                        type: boolean
                        description: Whether the secret is external
                      mountPath:
                        type: string
                        description: Mount path for the secret
                      externalType:
                        type: string
                        description: Type of external secret
                      roleARN:
                        type: string
                        description: ARN of the role
                      subPath:
                        type: string
                        description: Sub path for the secret
                      filePermission:
                        type: string
                        description: File permissions
                      externalSecretType:
                        type: string
                        description: Type of external secret
                      esoSubPath:
                        type: string
                        description: ESO sub path
        pipelineStrategy:
          type: object
          properties:
            config:
              type: object
              properties:
                codeEditorValue:
                  type: object
                  properties:
                    value:
                      type: string
                      description: Strategy value
                    displayName:
                      type: string
                      description: Display name of the strategy
                pipelineTriggerType:
                  type: string
                  description: Type of pipeline trigger
                strategy:
                  type: string
                  description: Deployment strategy
    Error:
      type: object
      properties:
        code:
          type: integer
          format: int32
          description: Error code
        status:
          type: string
          description: Error message
        userDetailedMessage:
          type: string
          description: Detailed error message for user