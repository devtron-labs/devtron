openapi: 3.1.0
info:
  title: Resource Recommender
  description: Analyzes the history of resource usage (such as CPU and memory) for Kubernetes workloads in a specific cluster and generates data-backed recommendations for optimal resource allocation.
  version: 0.0.2
servers:
  - url: http://localhost:8080/orchestrator
    description: Devtron API Server

paths:
  /k8s/resource/recommended:
    post:
      summary: Get Resource Recommendation for a particular resource
      description: Fetch resource recommendations for a specific Kubernetes resource.
      operationId: GetResourceRecommendation
      security: []
      requestBody:
        description: JSON containing details required to fetch cluster resource recommendations.
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ResourceRequestObject'
      responses:
        '200':
          description: Resource recommendation response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResourceGetResponse'
      tags:
        - Resource Recommendation

  /k8s/resource/recommendation/sync:
    post:
      summary: Sync Cluster Resource Recommendations
      description: Sync resource recommendations for a cluster.
      operationId: SyncClusterResourceRecommendations
      security: []
      requestBody:
        description: JSON containing details required to sync cluster resource recommendations.
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SyncResourceRecommendation'
      responses:
        '200':
          description: Cluster resource recommendation sync response
          content:
            application/json:
              schema:
                type: string
                description: Message indicating sync status
      tags:
        - Resource Recommendation

  /k8s/resource/{clusterId}/recommendation/details:
    get:
      summary: Get Cluster Resource Recommendation Details
      description: Fetch metadata of resource recommendations for a cluster.
      operationId: GetClusterResourceRecommendationDetails
      security: []
      parameters:
        - name: clusterId
          in: path
          required: true
          description: ID of the target cluster.
          schema:
            type: number
      responses:
        '200':
          description: Cluster resource recommendation details response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResourceRecommendationDetails'
      tags:
        - Resource Recommendation

  /k8s/resource/recommendation/list:
    post:
      summary: Get Cluster Resource Recommendation List
      description: Fetch all workloads and their resource recommendations.
      operationId: GetClusterResourceRecommendationList
      security: []
      requestBody:
        description: JSON containing details required to fetch cluster resource recommendations.
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ResourceRequestObject'
      responses:
        '200':
          description: Cluster resource recommendation list response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClusterResourceRecommendationList'
      tags:
        - Resource Recommendation

components:
  schemas:
    ManifestResponse:
      type: object
      required:
        - manifest
      properties:
        recommendedManifest:
          description: Recommended manifest for the resource.
          $ref: '#/components/schemas/K8sManifest'
        manifest:
          description: Current manifest for the resource.
          $ref: '#/components/schemas/K8sManifest'

    SyncResourceRecommendation:
      type: object
      description: Request object for syncing resource recommendations for a cluster.
      required:
        - clusterId
      properties:
        clusterId:
          type: number
          description: ID of the target cluster.

    ResourceRecommendationDetails:
      type: object
      description: Details of resource recommendations for a cluster.
      required:
        - supportedGVKs
      properties:
        supportedGVKs:
          type: array
          description: List of supported workload GVKs for resource recommendations.
          items:
            $ref: '#/components/schemas/GroupVersionKind'
        lastScannedOn:
          type: string
          format: date-time
          description: Timestamp of the last scan for resource recommendations.

    ResourceRequestObject:
      type: object
      required:
        - clusterId
      properties:
        clusterId:
          type: number
          description: ID of the target cluster.
        k8sRequest:
          $ref: '#/components/schemas/K8sRequestObject'

    K8sRequestObject:
      type: object
      description: Kubernetes request object containing resource identifiers for filtering.
      properties:
        resourceIdentifier:
          type: object
          description: Resource identifier filter for the Kubernetes resource.
          allOf:
            - $ref: '#/components/schemas/GroupVersionKind'
          properties:
            namespace:
              type: string
              description: Namespace of the Kubernetes resource for filtering.

    GroupVersionKind:
      type: object
      description: Group, Version, and Kind of the Kubernetes resource.
      properties:
        group:
          type: string
          description: Group of the Kubernetes resource.
        version:
          type: string
          description: Version of the Kubernetes resource.
        kind:
          type: string
          description: Kind of the Kubernetes resource.

    ClusterResourceRecommendationList:
      type: object
      properties:
        headers:
          type: array
          items:
            type: string
            enum:
              - name
              - namespace
              - kind
              - apiVersion
              - containerName
              - cpuRequest
              - cpuLimit
              - memoryRequest
              - memoryLimit
        data:
          type: array
          items:
            type: object
            properties:
              name:
                type: string
                description: Name of the workload resource.
              namespace:
                type: string
                description: Namespace of the workload resource.
              kind:
                type: string
                description: Kind of the workload resource.
              apiVersion:
                type: string
                description: API version of the workload resource.
              containerName:
                type: string
                description: Name of the container in the workload resource.
              cpuRequest:
                $ref: '#/components/schemas/ResourceRecommendation'
              cpuLimit:
                $ref: '#/components/schemas/ResourceRecommendation'
              memoryRequest:
                $ref: '#/components/schemas/ResourceRecommendation'
              memoryLimit:
                $ref: '#/components/schemas/ResourceRecommendation'

    ResourceRecommendation:
      type: object
      description: Resource recommendation details for a workload.
      required:
        - current
      properties:
        delta:
          type: number
          format: float64
          description: Percentage change in resource recommendation.
        current:
          type: string
          description: Current value of the resource recommendation.
        recommended:
          type: string
          description: Recommended value of the resource recommendation.

    ResourceGetResponse:
      type: object
      required:
        - manifestResponse
        - secretViewAccess
      properties:
        manifestResponse:
          $ref: '#/components/schemas/ManifestResponse'
        secretViewAccess:
          type: boolean
          description: Whether a user can see obscured secret values.

    K8sManifest:
      type: object
      description: Kubernetes manifest of the resource.
      additionalProperties: true
